import sys
sys.stdin = open("input.txt")
from collections import deque

def rotate(pos, rot):

    rotate_dict[pos] = rot

    cur_rot = rot
    for j in range(pos, 3):
        if magnet[j][2] == magnet[j+1][6]:
            break
        elif magnet[j][2] != magnet[j+1][6]:
            cur_rot *= -1
            rotate_dict[j+1] = cur_rot

    cur_rot = rot
    for j in range(pos, 0, -1):
        if magnet[j][6] == magnet[j-1][2]:
            break
        elif magnet[j][6] != magnet[j-1][2]:
            cur_rot *= -1
            rotate_dict[j-1] = cur_rot

    return rotate_dict

T = int(input())
for tc in range(1, T+1):
    K = int(input())
    magnet = [deque(map(int, input().split())) for _ in range(4)]

    for i in range(K):
        pos, rot = map(int, input().split())
        pos -= 1
        rotate_dict = {0: 0, 1: 0, 2: 0, 3: 0}
        rotate(pos, rot)

        for j in range(4):
            if rotate_dict[j] != 0:
                magnet[j].rotate(rotate_dict[j])

    result = 0
    for i in range(4):
        if magnet[i][0] == 1:
            result += (2 ** i)

    print(f'#{tc} {result}')
